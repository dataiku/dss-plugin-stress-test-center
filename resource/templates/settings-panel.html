<div class="webapp__subsection">
    <div class="grand-title-b flex settings-section__header">
        Stress tests
        <help-icon class="small-title-b" help-text="Select the tests corresponding to corruptions you expect to have at deployment time, and assess the robustness of your model"></help-icon>
    </div>
    <form name="forms.SAMPLES" class="settings-subsection__form" ng-submit="runAnalysis()">
        <div class="control-group settings-subsection__form_field">
            <label for="samples" class="label-text">Proportion of samples for all the stress tests</label>
            <input type="number" id="samples" ng-model="tests.samples" step="0.01" min="0.01" max="1" required>
            <div class="text-tiny">
                Set the proportion of rows used to run the selected tests
            </div>
        </div>
        <div class="control-group settings-subsection__form_field">
            <label for="randomSeed" class="label-text">Random seed</label>
            <input type="number" id="randomSeed"
                   ng-model="tests.randomSeed"
                   placeholder="65537" step="1" required>
        </div>
        <div class="dku-btn-container--right-align settings-subsection__form_field">
            <button class="dku-btn dku-btn-primary"
                    type="button"
                    ng-disabled="loading.results || !checkTestConfig().canRun"
                    ng-click="runAnalysis()">
                Run tests
            </button>
        </div>
    </form>
</div>

<div ng-if="loading.modelInfo" class="webapp__subsection spinner-div">
    <spinner></spinner>
</div>

<div ng-if="!loading.modelInfo && tests.perturbations.Rebalance" class="webapp__subsection">
    <div class="flex small-title-b settings-subsection__header">
        <label class="flex" ng-class="{'text-lighter': !tests.perturbations.Rebalance.$activated}">
            <label class="switch">
                <input type="checkbox" ng-model="tests.perturbations.Rebalance.$activated">
                <div class="slider round"></div>
            </label>
            {{ tests.perturbations.Rebalance.displayName }}
        </label>
        <help-icon help-text="Modifies the target distribution by resampling"></help-icon>
    </div>
    <form name="forms.Rebalance" class="settings-subsection__form"
          ng-show="tests.perturbations.Rebalance.$activated" ng-submit="runAnalysis()">
        <div key-value-list map="tests.perturbations.Rebalance.params.priors"
             key-options="modelInfo.targetClasses"
             key-label="Target classes"
             key-item-label="class"
             value-label="Proportion"
             value-range="[0,1]"
             form="forms.Rebalance"
             class="settings-subsection__form_field">
        </div>
    </form>
</div>

<div ng-if="!loading.modelInfo && tests.perturbations.MissingValues" class="webapp__subsection">
    <div class="flex small-title-b settings-subsection__header">
        <label class="flex" ng-class="{'text-lighter': !tests.perturbations.MissingValues.$activated}">
            <label class="switch">
                <input type="checkbox" ng-model="tests.perturbations.MissingValues.$activated">
                <div class="slider round"></div>
            </label>
            {{ tests.perturbations.MissingValues.displayName }}
        </label>
        <help-icon help-text="Randomly inserts missing values"></help-icon>
    </div>
    <form name="forms.MissingValues" class="settings-subsection__form"
          ng-show="tests.perturbations.MissingValues.$activated" ng-submit="runAnalysis()">
        <div custom-dropdown
             form="forms.MissingValues"
             possible-values="tests.perturbations.MissingValues.availableColumns"
             items="tests.perturbations.MissingValues.selected_features"
             item-name="feature"
             item-image="featureToTypeIcon"
             label="Corrupted features"
             class="settings-subsection__form_field">
        </div>
        <div class="control-group settings-subsection__form_field">
            <label for="missingValuesSamples" class="label-text">Proportion of corrupted samples</label>
            <input type="number" id="missingValuesSamples"
                   ng-model="tests.perturbations.MissingValues.params.samples_fraction"
                   placeholder="0.5" step="0.01" min="0.01" max="1" required>
        </div>
    </form>
</div>

<div ng-if="!loading.modelInfo && tests.perturbations.Scaling" class="webapp__subsection">
    <div class="flex small-title-b settings-subsection__header">
        <label class="flex" ng-class="{'text-lighter': !tests.perturbations.Scaling.$activated}">
            <label class="switch">
                <input type="checkbox" ng-model="tests.perturbations.Scaling.$activated">
                <div class="slider round"></div>
            </label>
            {{ tests.perturbations.Scaling.displayName }}
        </label>
        <help-icon help-text="Changes the order of magnitude of each feature by some random scaling"></help-icon>
    </div>
    <form name="forms.Scaling" class="settings-subsection__form"
          ng-show="tests.perturbations.Scaling.$activated" ng-submit="runAnalysis()">
        <div custom-dropdown
             form="forms.Scaling"
             possible-values="tests.perturbations.Scaling.availableColumns"
             items="tests.perturbations.Scaling.selected_features"
             item-name="feature"
             item-image="featureToTypeIcon"
             label="Corrupted features"
             class="settings-subsection__form_field">
        </div>
        <div class="control-group settings-subsection__form_field">
            <label for="scalingFactor" class="label-text">Scaling factor</label>
            <input type="number" id="scalingFactor"
                   ng-model="tests.perturbations.Scaling.params.scaling_factor" required>
        </div>
        <div class="control-group settings-subsection__form_field">
            <label for="scalingSamples" class="label-text">Proportion of corrupted samples</label>
            <input type="number" id="scalingSamples"
                   ng-model="tests.perturbations.Scaling.params.samples_fraction"
                   placeholder="0.5" step="0.01" min="0" max="1" required>
        </div>
    </form>
</div>
